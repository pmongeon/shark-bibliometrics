mutate(oecd_minor = tolower(oecd_minor),
oecd_major = tolower(oecd_major))
income_group <- pubs %>%
select(country) %>%
left_join(country, by = "country") %>%
unique() %>%
left_join(wb_data, by = c("country_iso_alpha3_code" = "Country Code")) %>%
select(country, IncomeGroup) %>%
rbind(c("Kosovo","Upper middle income"))
# Table 1 ----
table1 <- pubs %>%
filter(country == "All countries" & !is.na(disc)) %>%
left_join(field, by = c("disc" = "oecd_minor")) %>%
group_by(oecd_major) %>%
summarise(is_in_unpaywall = sum(is_in_unpaywall),
pct_gold = sum(is_gold)/sum(is_in_unpaywall),
pct_green = sum(is_green)/sum(is_in_unpaywall),
pct_oa = sum(is_oa)/sum(is_in_unpaywall),
pct_gold_only = sum(is_gold_only)/sum(is_in_unpaywall),
pct_green_only = sum(is_green_only)/sum(is_in_unpaywall)) %>%
ungroup() %>%
mutate(oecd_major = replace_na(oecd_major, "all disciplines")) %>%
select(oecd_major, is_in_unpaywall, pct_gold, pct_green, pct_oa, pct_gold_only, pct_green_only)
write_csv(table1, "table1.csv")
# Table 2 ----
table2 <- refs %>%
filter(country == "All countries" & !is.na(disc)) %>%
left_join(field, by = c("disc" = "oecd_minor")) %>%
group_by(oecd_major) %>%
summarise(is_in_unpaywall = sum(is_in_unpaywall),
pct_gold = sum(is_gold)/sum(is_in_unpaywall),
pct_green = sum(is_green)/sum(is_in_unpaywall),
pct_oa = sum(is_oa)/sum(is_in_unpaywall),
pct_gold_only = sum(is_gold_only)/sum(is_in_unpaywall),
pct_green_only = sum(is_green_only)/sum(is_in_unpaywall)) %>%
ungroup() %>%
mutate(oecd_major = replace_na(oecd_major, "all disciplines")) %>%
select(oecd_major, is_in_unpaywall, pct_gold, pct_green, pct_oa, pct_gold_only, pct_green_only)
write_csv(table2, "table2.csv")
country_pct_oa <- pubs %>%
filter(disc != "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country, disc) %>%
summarize(pct_oa = replace_na(sum(is_oa)/sum(is_in_unpaywall),0),
pct_gold = replace_na(sum(is_gold)/sum(is_in_unpaywall),0),
pct_green = replace_na(sum(is_green)/sum(is_in_unpaywall),0),
pct_hybrid = replace_na(sum(is_hybrid)/sum(is_in_unpaywall),0),
pct_bronze = replace_na(sum(is_bronze)/sum(is_in_unpaywall),0)
) %>%
ungroup()
country_pct_oa_all_disciplines <- pubs %>%
filter(disc == "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country) %>%
summarize(pct_oa = replace_na(sum(is_oa)/sum(is_in_unpaywall),0),
pct_gold = replace_na(sum(is_gold)/sum(is_in_unpaywall),0),
pct_green = replace_na(sum(is_green)/sum(is_in_unpaywall),0),
pct_hybrid = replace_na(sum(is_hybrid)/sum(is_in_unpaywall),0),
pct_bronze = replace_na(sum(is_bronze)/sum(is_in_unpaywall),0)
) %>%
ungroup()
head(country_pct_oa_all_disciplines)
country_total_pubs <- pubs %>%
filter(disc == "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country) %>%
summarize(total_wos = sum(n_pubs),
total_doi = sum(has_doi),
total_unpaywall = sum(is_in_unpaywall)
) %>%
ungroup()
country_pct_disc <- pubs %>%
filter(disc != "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country, disc) %>%
summarize(is_in_unpaywall = sum(is_in_unpaywall)) %>%
left_join(country_total_pubs, by="country") %>%
group_by(country, disc) %>%
summarise(pct_disc = is_in_unpaywall/total_unpaywall) %>%
ungroup()
head(country_pct_disc)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
summarize(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
) %>%
mutate(z_oa = (weighted_oa-mean(weighted_oa))/sd(weighted_oa),
z_gold = (weighted_gold-mean(weighted_gold))/sd(weighted_gold),
z_green = (weighted_green-mean(weighted_green))/sd(weighted_green),
z_hybrid = (log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))-mean(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))))/sd(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))),
z_bronze = (log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))-mean(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))))/sd(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze)))
) %>%
ungroup() %>%
left_join(country_pct_oa_all_disciplines, by = "country") %>%
left_join(country_total_pubs, by = "country") %>%
left_join(income_group, by = "country")
head(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
mutate(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
) %>%
mutate(z_oa = (weighted_oa-mean(weighted_oa))/sd(weighted_oa),
z_gold = (weighted_gold-mean(weighted_gold))/sd(weighted_gold),
z_green = (weighted_green-mean(weighted_green))/sd(weighted_green),
z_hybrid = (log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))-mean(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))))/sd(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))),
z_bronze = (log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))-mean(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))))/sd(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze)))
) %>%
ungroup() %>%
left_join(country_pct_oa_all_disciplines, by = "country") %>%
left_join(country_total_pubs, by = "country") %>%
left_join(income_group, by = "country")
head(country_data)
head(country_pct_disc)
head(country_pct_oa)
head(country_pct_oa)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country, disc) %>%
mutate(country_total = sum(pct_disc))
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country, disc) %>%
mutate(country_total = sum(pct_disc)) %>%
mutate(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
) %>%
mutate(z_oa = (weighted_oa-mean(weighted_oa))/sd(weighted_oa),
z_gold = (weighted_gold-mean(weighted_gold))/sd(weighted_gold),
z_green = (weighted_green-mean(weighted_green))/sd(weighted_green),
z_hybrid = (log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))-mean(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))))/sd(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))),
z_bronze = (log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))-mean(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))))/sd(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze)))
) %>%
ungroup() %>%
left_join(country_pct_oa_all_disciplines, by = "country") %>%
left_join(country_total_pubs, by = "country") %>%
left_join(income_group, by = "country")
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country, disc) %>%
mutate(country_total = sum(pct_disc)) %>%
mutate(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
)
View(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
mutate(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
)
View(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
summarize(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
)
View(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc"))
View(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc))
View(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
ungroup() %>%
group_by(country, disc) %>%
summarize(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
)
View(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
ungroup() %>%
group_by(country, disc) %>%
mutate(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
)
View(country_data)
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
ungroup() %>%
group_by(country, disc) %>%
summarize(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
) %>%
mutate(z_oa = (weighted_oa-mean(weighted_oa))/sd(weighted_oa),
z_gold = (weighted_gold-mean(weighted_gold))/sd(weighted_gold),
z_green = (weighted_green-mean(weighted_green))/sd(weighted_green),
z_hybrid = (log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))-mean(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))))/sd(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))),
z_bronze = (log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))-mean(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))))/sd(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze)))
) %>%
ungroup() %>%
left_join(country_pct_oa_all_disciplines, by = "country") %>%
left_join(country_total_pubs, by = "country") %>%
left_join(income_group, by = "country")
head(country_data)
View(country_data)
write_csv(country_data, "data_pubs.csv")
country_pct_oa <- refs %>%
filter(disc != "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country, disc) %>%
summarize(pct_oa = replace_na(sum(is_oa)/sum(is_in_unpaywall),0),
pct_gold = replace_na(sum(is_gold)/sum(is_in_unpaywall),0),
pct_green = replace_na(sum(is_green)/sum(is_in_unpaywall),0),
pct_hybrid = replace_na(sum(is_hybrid)/sum(is_in_unpaywall),0),
pct_bronze = replace_na(sum(is_bronze)/sum(is_in_unpaywall),0)
) %>%
ungroup()
country_pct_oa <- refs %>%
filter(disc != "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country, disc) %>%
summarize(pct_oa = replace_na(sum(is_oa)/sum(is_in_unpaywall),0),
pct_gold = replace_na(sum(is_gold)/sum(is_in_unpaywall),0),
pct_green = replace_na(sum(is_green)/sum(is_in_unpaywall),0),
pct_hybrid = replace_na(sum(is_hybrid)/sum(is_in_unpaywall),0),
pct_bronze = replace_na(sum(is_bronze)/sum(is_in_unpaywall),0)
) %>%
ungroup()
country_pct_oa_all_disciplines <- refs %>%
filter(disc == "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country) %>%
summarize(pct_oa = replace_na(sum(is_oa)/sum(is_in_unpaywall),0),
pct_gold = replace_na(sum(is_gold)/sum(is_in_unpaywall),0),
pct_green = replace_na(sum(is_green)/sum(is_in_unpaywall),0),
pct_hybrid = replace_na(sum(is_hybrid)/sum(is_in_unpaywall),0),
pct_bronze = replace_na(sum(is_bronze)/sum(is_in_unpaywall),0)
) %>%
ungroup()
country_total_pubs <- refs %>%
filter(disc == "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country) %>%
summarize(total_wos = sum(n_refs),
total_doi = sum(has_doi),
total_unpaywall = sum(is_in_unpaywall)
) %>%
ungroup()
country_pct_disc <- refs %>%
filter(disc != "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country, disc) %>%
summarize(is_in_unpaywall = sum(is_in_unpaywall)) %>%
left_join(country_total_pubs, by="country") %>%
group_by(country, disc) %>%
summarise(pct_disc = is_in_unpaywall/total_unpaywall) %>%
ungroup()
country_pct_disc <- refs %>%
filter(disc != "all disciplines" & (first_country == 1 | reprint_country == 1) & !is.na(country)) %>%
group_by(country, disc) %>%
summarize(is_in_unpaywall = sum(is_in_unpaywall)) %>%
left_join(country_total_pubs, by="country") %>%
group_by(country, disc) %>%
summarise(pct_disc = is_in_unpaywall/total_unpaywall) %>%
ungroup()
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
summarize(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
) %>%
mutate(z_oa = (weighted_oa-mean(weighted_oa))/sd(weighted_oa),
z_gold = (weighted_gold-mean(weighted_gold))/sd(weighted_gold),
z_green = (weighted_green-mean(weighted_green))/sd(weighted_green),
z_hybrid = (log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))-mean(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))))/sd(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))),
z_bronze = (log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))-mean(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))))/sd(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze)))
) %>%
ungroup() %>%
left_join(country_pct_oa_all_disciplines, by = "country") %>%
left_join(country_total_pubs, by = "country") %>%
left_join(income_group, by = "country")
View(refs)
write_csv(country_data, "data_refs.csv")
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
ungroup() %>%
group_by(country, disc) %>%
summarize(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
) %>%
mutate(z_oa = (weighted_oa-mean(weighted_oa))/sd(weighted_oa),
z_gold = (weighted_gold-mean(weighted_gold))/sd(weighted_gold),
z_green = (weighted_green-mean(weighted_green))/sd(weighted_green),
z_hybrid = (log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))-mean(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))))/sd(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))),
z_bronze = (log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))-mean(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))))/sd(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze)))
) %>%
ungroup() %>%
left_join(country_pct_oa_all_disciplines, by = "country") %>%
left_join(country_total_pubs, by = "country") %>%
left_join(income_group, by = "country")
country_data  <- country_pct_disc %>%
left_join(country_pct_oa, by = c("country","disc")) %>%
group_by(country) %>%
mutate(country_total = sum(pct_disc)) %>%
ungroup() %>%
group_by(country, disc) %>%
summarize(weighted_oa = sum((pct_disc/country_total)*pct_oa),
weighted_gold = sum((pct_disc/country_total)*pct_gold),
weighted_green = sum((pct_disc/country_total)*pct_green),
weighted_hybrid = sum((pct_disc/country_total)*pct_hybrid),
weighted_bronze = sum((pct_disc/country_total)*pct_bronze)
) %>%
mutate(z_oa = (weighted_oa-mean(weighted_oa))/sd(weighted_oa),
z_gold = (weighted_gold-mean(weighted_gold))/sd(weighted_gold),
z_green = (weighted_green-mean(weighted_green))/sd(weighted_green),
z_hybrid = (log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))-mean(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))))/sd(log(case_when(weighted_hybrid == 0 ~ 0.01, weighted_hybrid > 0 ~ weighted_hybrid))),
z_bronze = (log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))-mean(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze))))/sd(log(case_when(weighted_bronze == 0 ~ 0.01, weighted_bronze > 0 ~ weighted_bronze)))
) %>%
ungroup() %>%
left_join(country_pct_oa_all_disciplines, by = "country") %>%
left_join(country_total_pubs, by = "country") %>%
left_join(income_group, by = "country")
write_csv(country_data, "data_refs.csv")
help(zip)
# Working directory
setwd("C:/Users/Philippe/Documents/GitHub/shark-project")
# Load needed packages ----
library(sqldf)
library(tidyverse)
library(readxl)
# Working directory
setwd("C:/Users/Philippe/Documents/GitHub/shark-project")
# Load data ----
Articles <- read_excel("shark_data.xlsx", sheet ="papers")
Citations <- read_excel("shark_data.xlsx", sheet ="citations")
# Load data ----
Articles <- read_excel("data/shark_data.xlsx", sheet ="papers")
Citations <- read_excel("data/shark_data.xlsx", sheet ="citations")
# bibliographic coupling ----
BCNetwork <- sqldf("
SELECT DISTINCT
a.ut as Source,
d.ut as Target,
count(distinct b.cited_ut) as Weight,
'undirected' as Type
FROM Articles a
JOIN Citations b on b.citing_ut = a.ut
JOIN Citations c on c.cited_ut = b.cited_ut
JOIN Articles d on d.ut = c.citing_ut
WHERE d.ut > a.ut
GROUP BY a.ut, d.ut
ORDER BY count(distinct b.cited_ut) desc
")
# Co-citation ----
CCNetwork <- sqldf("
SELECT DISTINCT
a.ut as Source,
d.ut as Target,
count(distinct b.citing_ut) as Weight,
'undirected' as Type
FROM Articles a
JOIN Citations b on b.cited_ut = a.ut
JOIN Citations c on c.citing_ut = b.citing_ut
JOIN Articles d on d.ut = c.cited_ut
WHERE d.ut > a.ut
GROUP BY a.ut, d.ut
ORDER BY count(distinct b.cited_ut) desc
")
# Direct citation ----
DCNetwork <- sqldf("
SELECT DISTINCT
a.ut as Source,
c.ut as Target,
1 as Weight,
'directed' as Type
FROM Articles a
JOIN Citations b on b.citing_ut = a.ut
JOIN Articles c on c.ut = b.cited_ut
")
CCBCNetwork <- rbind(CCNetwork.BCNetwork)
CCBCNetwork <- rbind(CCNetwork.BCNetwork)
View(CCNetwork)
CCBCNetwork <- rbind(CCNetwork,BCNetwork)
CCBCNetwork <- CCBCNetwork %>%
group_by(source, target, type) %>%
summarize(weight = sum(weight))
CCBCNetwork <- CCBCNetwork %>%
group_by(Source, Target, Type) %>%
summarize(Weight = sum(Weight))
View(CCBCNetwork)
# Load data ----
Articles <- read_excel("data/shark_data.xlsx", sheet ="papers")
Citations <- read_excel("data/shark_data.xlsx", sheet ="citations")
getwd()
# Load needed packages ----
library(sqldf)
library(tidyverse)
library(readxl)
# Load data ----
Articles <- read_excel("data/shark_data.xlsx", sheet ="papers")
Citations <- read_excel("data/shark_data.xlsx", sheet ="citations")
# bibliographic coupling ----
BCNetwork <- sqldf("
SELECT DISTINCT
a.ut as Source,
d.ut as Target,
count(distinct b.cited_ut) as Weight,
'undirected' as Type
FROM Articles a
JOIN Citations b on b.citing_ut = a.ut
JOIN Citations c on c.cited_ut = b.cited_ut
JOIN Articles d on d.ut = c.citing_ut
WHERE d.ut > a.ut
GROUP BY a.ut, d.ut
ORDER BY count(distinct b.cited_ut) desc
")
# Co-citation ----
CCNetwork <- sqldf("
SELECT DISTINCT
a.ut as Source,
d.ut as Target,
count(distinct b.citing_ut) as Weight,
'undirected' as Type
FROM Articles a
JOIN Citations b on b.cited_ut = a.ut
JOIN Citations c on c.citing_ut = b.citing_ut
JOIN Articles d on d.ut = c.cited_ut
WHERE d.ut > a.ut
GROUP BY a.ut, d.ut
ORDER BY count(distinct b.cited_ut) desc
")
# Direct citation ----
DCNetwork <- sqldf("
SELECT DISTINCT
a.ut as Source,
c.ut as Target,
1 as Weight,
'directed' as Type
FROM Articles a
JOIN Citations b on b.citing_ut = a.ut
JOIN Articles c on c.ut = b.cited_ut
")
CCBCNetwork <- rbind(CCNetwork,BCNetwork)
CCBCNetwork <- CCBCNetwork %>%
group_by(Source, Target, Type) %>%
summarize(Weight = sum(Weight))
write.csv(DCNetwork,"networks/DC_network_articles.csv", row.names = FALSE)
write.csv(CCBCNetwork,"networks/CCBC_network_articles.csv", row.names = FALSE)
# Load needed packages ----
library(sqldf) # for running SQL in R
library(rio) # for the import function
library(stringr)
library(tidyverse)
library(data.table) # For the parsing
library(tm) # For the stemming
library(readxl)
library(tidytext)
library(textstem)
# Load data ----
Articles <- read_excel("data/shark_data.xlsx", sheet ="papers")
Citations <- read_excel("data/shark_data.xlsx", sheet ="citations")
# parser les titres + abstracts pour faire la table id_art | mot
text <- Articles %>%
unite(text, c("title", "abstract")) %>% # Concatene le titre et l'abstract dans la colonne text
select(ut, text) %>%  # selectionne seulement les colonnes id_art et text
unique()
text <- text %>%
unnest_tokens(word, text, token = "ngrams", n = 1) %>%
select(id_art, word) %>%
drop_na(word) %>%
mutate(stemmed = stem_words(word))
text <- text %>%
unnest_tokens(word, text, token = "ngrams", n = 1) %>%
select(ut, word) %>%
drop_na(word) %>%
mutate(stemmed = stem_words(word))
